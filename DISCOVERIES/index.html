
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AI-powered development framework for Claude Code">
      
      
      
        <link rel="canonical" href="https://rysweet.github.io/MicrosoftHackathon2025-AgenticCoding/DISCOVERIES/">
      
      
        <link rel="prev" href="../BENCHMARKING/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Discoveries - amplihack</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#discoveriesmd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="amplihack" class="md-header__button md-logo" aria-label="amplihack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            amplihack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Discoveries
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/rysweet/MicrosoftHackathon2025-AgenticCoding" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    amplihack
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../PREREQUISITES/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../PHILOSOPHY/" class="md-tabs__link">
          
  
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../AUTO_MODE/" class="md-tabs__link">
          
  
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../DEVELOPING_AMPLIHACK/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../BENCHMARKING/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="amplihack" class="md-nav__button md-logo" aria-label="amplihack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    amplihack
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rysweet/MicrosoftHackathon2025-AgenticCoding" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    amplihack
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PREREQUISITES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AUTO_MODE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PROXY_CONFIG_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PHILOSOPHY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Philosophy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WORKFLOW_COMPLETION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AUTO_MODE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent-bundle-generator-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Bundles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../document_driven_development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document-Driven Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/power-steering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Power-Steering Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/power-steering/customization-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Power-Steering Customization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DEVELOPING_AMPLIHACK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../IMPLEMENTATION_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CREATE_YOUR_OWN_TOOLS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../BENCHMARKING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Discoveries
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Discoveries
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#auto-mode-sdk-integration-challenges-2025-10-25" class="md-nav__link">
    <span class="md-ellipsis">
      
        Auto Mode SDK Integration Challenges (2025-10-25)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Auto Mode SDK Integration Challenges (2025-10-25)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-openai-proxy-port-binding-failures-2025-10-24" class="md-nav__link">
    <span class="md-ellipsis">
      
        Azure OpenAI Proxy Port Binding Failures (2025-10-24)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Azure OpenAI Proxy Port Binding Failures (2025-10-24)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hook-execution-permissions-and-path-handling-2025-10-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hook Execution Permissions and Path Handling (2025-10-20)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hook Execution Permissions and Path Handling (2025-10-20)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worktree-management-and-branch-isolation-2025-10-18" class="md-nav__link">
    <span class="md-ellipsis">
      
        Worktree Management and Branch Isolation (2025-10-18)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Worktree Management and Branch Isolation (2025-10-18)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context-preservation-across-sessions-2025-10-15" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Preservation Across Sessions (2025-10-15)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context Preservation Across Sessions (2025-10-15)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#philosophy-violations-in-generated-code-2025-10-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        Philosophy Violations in Generated Code (2025-10-12)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Philosophy Violations in Generated Code (2025-10-12)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting-and-token-budget-management-2025-10-08" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rate Limiting and Token Budget Management (2025-10-08)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limiting and Token Budget Management (2025-10-08)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-this-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to Use This File
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to Use This File">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-add-an-entry" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Add an Entry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entry-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Entry Template
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maintenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#auto-mode-sdk-integration-challenges-2025-10-25" class="md-nav__link">
    <span class="md-ellipsis">
      
        Auto Mode SDK Integration Challenges (2025-10-25)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Auto Mode SDK Integration Challenges (2025-10-25)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-openai-proxy-port-binding-failures-2025-10-24" class="md-nav__link">
    <span class="md-ellipsis">
      
        Azure OpenAI Proxy Port Binding Failures (2025-10-24)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Azure OpenAI Proxy Port Binding Failures (2025-10-24)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hook-execution-permissions-and-path-handling-2025-10-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hook Execution Permissions and Path Handling (2025-10-20)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hook Execution Permissions and Path Handling (2025-10-20)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#worktree-management-and-branch-isolation-2025-10-18" class="md-nav__link">
    <span class="md-ellipsis">
      
        Worktree Management and Branch Isolation (2025-10-18)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Worktree Management and Branch Isolation (2025-10-18)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context-preservation-across-sessions-2025-10-15" class="md-nav__link">
    <span class="md-ellipsis">
      
        Context Preservation Across Sessions (2025-10-15)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context Preservation Across Sessions (2025-10-15)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#philosophy-violations-in-generated-code-2025-10-12" class="md-nav__link">
    <span class="md-ellipsis">
      
        Philosophy Violations in Generated Code (2025-10-12)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Philosophy Violations in Generated Code (2025-10-12)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting-and-token-budget-management-2025-10-08" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rate Limiting and Token Budget Management (2025-10-08)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rate Limiting and Token Budget Management (2025-10-08)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Issue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-cause_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Root Cause
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-learnings_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Learnings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-use-this-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to Use This File
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="How to Use This File">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-add-an-entry" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Add an Entry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entry-template" class="md-nav__link">
    <span class="md-ellipsis">
      
        Entry Template
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Maintenance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="discoveriesmd">DISCOVERIES.md<a class="headerlink" href="#discoveriesmd" title="Permanent link">&para;</a></h1>
<p>This file documents non-obvious problems, solutions, and patterns discovered during amplihack development. Review and update this regularly, removing outdated entries or those replaced by better practices, code, or tools. Update entries where best practices have evolved.</p>
<h2 id="auto-mode-sdk-integration-challenges-2025-10-25">Auto Mode SDK Integration Challenges (2025-10-25)<a class="headerlink" href="#auto-mode-sdk-integration-challenges-2025-10-25" title="Permanent link">&para;</a></h2>
<h3 id="issue">Issue<a class="headerlink" href="#issue" title="Permanent link">&para;</a></h3>
<p>Auto mode integration with Claude Code SDK had multiple failure modes including session fork crashes, missing UI flags, and test enforcement not respecting auto mode context.</p>
<h3 id="root-cause">Root Cause<a class="headerlink" href="#root-cause" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Session management complexity</strong>: Multiple approaches (SDK fork, environment variable export, process spawning) created confusion</li>
<li><strong>Flag inconsistency</strong>: --ui flag was removed in some code paths but not others</li>
<li><strong>Test enforcement blindness</strong>: Test enforcement system didn't check for auto mode before failing on missing tests</li>
<li><strong>PID exposure</strong>: Security violation from exposing process IDs in auto mode output</li>
</ol>
<h3 id="solution">Solution<a class="headerlink" href="#solution" title="Permanent link">&para;</a></h3>
<p><strong>Issue #1013 resolution</strong> implemented hybrid session management:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Hybrid approach: SDK fork for subprocess + environment variable export</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">session_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sdk</span><span class="o">.</span><span class="n">export_for_subprocess</span><span class="p">()</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CLAUDE_CODE_SESSION_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_data</span><span class="p">[</span><span class="s2">&quot;session_id&quot;</span><span class="p">]</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># Fork SDK session for subprocess</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">fork_output</span> <span class="o">=</span> <span class="n">fork_manager</span><span class="o">.</span><span class="n">create_fork</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</code></pre></div>
<p><strong>Test enforcement</strong> updated to respect auto mode:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Check if running in auto mode before enforcing tests</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">is_auto_mode</span><span class="p">():</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">enforce_test_requirements</span><span class="p">()</span>
</code></pre></div>
<h3 id="key-learnings">Key Learnings<a class="headerlink" href="#key-learnings" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Hybrid session management works best</strong>: SDK fork for subprocess control + environment export for persistence</li>
<li><strong>Auto mode needs special handling</strong>: Many validation gates should be bypassed or adapted for auto mode</li>
<li><strong>Security first</strong>: Never expose process IDs or system internals in user-facing output</li>
<li><strong>Test with the actual SDK</strong>: Mock testing misses critical integration issues</li>
</ol>
<h3 id="prevention">Prevention<a class="headerlink" href="#prevention" title="Permanent link">&para;</a></h3>
<ul>
<li>Always check <code>is_auto_mode()</code> before enforcing validation gates</li>
<li>Use hybrid session management for subprocess creation</li>
<li>Never expose PIDs, absolute paths, or system internals</li>
<li>Test auto mode flows with real Claude SDK, not mocks</li>
</ul>
<h2 id="azure-openai-proxy-port-binding-failures-2025-10-24">Azure OpenAI Proxy Port Binding Failures (2025-10-24)<a class="headerlink" href="#azure-openai-proxy-port-binding-failures-2025-10-24" title="Permanent link">&para;</a></h2>
<h3 id="issue_1">Issue<a class="headerlink" href="#issue_1" title="Permanent link">&para;</a></h3>
<p>Proxy failed to start with port already in use errors, causing sessions to hang indefinitely waiting for proxy health check.</p>
<h3 id="root-cause_1">Root Cause<a class="headerlink" href="#root-cause_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Port persistence</strong>: Proxy process crashed but port remained bound to dead process</li>
<li><strong>No port cleanup</strong>: No mechanism to detect and clean up stale port bindings</li>
<li><strong>No timeout</strong>: Health check waited forever for proxy that would never start</li>
<li><strong>Silent failure</strong>: No clear error message about what went wrong</li>
</ol>
<h3 id="solution_1">Solution<a class="headerlink" href="#solution_1" title="Permanent link">&para;</a></h3>
<p><strong>Dynamic port selection</strong> with retry:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># Try binding to requested port, fall back to dynamic port if busy</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>        <span class="c1"># Try binding to check availability</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>        <span class="n">test_socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>        <span class="n">test_socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>        <span class="n">test_socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>        <span class="k">return</span> <span class="n">port</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="c1"># Port busy, try next port</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>        <span class="n">port</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div>
<p><strong>Health check timeout</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Don&#39;t wait forever for proxy</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">health_check_timeout</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># seconds</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">wait_for_proxy_health</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">health_check_timeout</span><span class="p">):</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="k">raise</span> <span class="n">ProxyStartupError</span><span class="p">(</span><span class="s2">&quot;Proxy failed to start within timeout&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="key-learnings_1">Key Learnings<a class="headerlink" href="#key-learnings_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Always implement timeouts</strong>: Never wait indefinitely for external processes</li>
<li><strong>Dynamic port selection prevents conflicts</strong>: Especially important for dev environments</li>
<li><strong>Fail fast and loud</strong>: Clear error messages save hours of debugging</li>
<li><strong>Clean up process state</strong>: Dead processes can hold resources</li>
</ol>
<h3 id="prevention_1">Prevention<a class="headerlink" href="#prevention_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Implement dynamic port selection for all network services</li>
<li>Always set timeouts on health checks and startup waits</li>
<li>Add cleanup logic for stale processes and port bindings</li>
<li>Log clear error messages with actionable guidance</li>
</ul>
<h2 id="hook-execution-permissions-and-path-handling-2025-10-20">Hook Execution Permissions and Path Handling (2025-10-20)<a class="headerlink" href="#hook-execution-permissions-and-path-handling-2025-10-20" title="Permanent link">&para;</a></h2>
<h3 id="issue_2">Issue<a class="headerlink" href="#issue_2" title="Permanent link">&para;</a></h3>
<p>User-provided hooks failed silently or with cryptic errors. Common failure modes:</p>
<ul>
<li>Hooks without execute permissions</li>
<li>Relative paths in hook configuration</li>
<li>Hooks timing out without clear feedback</li>
</ul>
<h3 id="root-cause_2">Root Cause<a class="headerlink" href="#root-cause_2" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>No permission checking</strong>: System didn't verify hooks were executable before attempting to run them</li>
<li><strong>Relative path confusion</strong>: Hooks specified with relative paths failed when run from different directories</li>
<li><strong>Silent timeouts</strong>: Hooks timing out produced no clear error message</li>
<li><strong>Inconsistent execution context</strong>: Hooks ran from various working directories</li>
</ol>
<h3 id="solution_2">Solution<a class="headerlink" href="#solution_2" title="Permanent link">&para;</a></h3>
<p><strong>Hook validation at installation time</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_hook</span><span class="p">(</span><span class="n">hook_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">hook_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>        <span class="k">raise</span> <span class="n">HookValidationError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hook does not exist: </span><span class="si">{</span><span class="n">hook_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">hook_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>        <span class="c1"># Try to add execute permission</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>        <span class="n">hook_path</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">hook_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">|</span> <span class="mo">0o111</span><span class="p">)</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added execute permission to hook: </span><span class="si">{</span><span class="n">hook_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="c1"># Convert to absolute path</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">hook_path</span> <span class="o">=</span> <span class="n">hook_path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
</code></pre></div>
<p><strong>Clear timeout handling</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>        <span class="n">hook_cmd</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        <span class="n">timeout</span><span class="o">=</span><span class="n">hook_timeout</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>        <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="p">)</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>        <span class="sa">f</span><span class="s2">&quot;Hook &#39;</span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s2">&#39; timed out after </span><span class="si">{</span><span class="n">hook_timeout</span><span class="si">}</span><span class="s2">s. &quot;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>        <span class="sa">f</span><span class="s2">&quot;Consider increasing timeout or optimizing hook.&quot;</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="p">)</span>
</code></pre></div>
<h3 id="key-learnings_2">Key Learnings<a class="headerlink" href="#key-learnings_2" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Validate early</strong>: Check prerequisites at configuration time, not execution time</li>
<li><strong>Absolute paths everywhere</strong>: Resolve relative paths immediately to avoid confusion</li>
<li><strong>Auto-fix when possible</strong>: Add execute permissions automatically rather than just failing</li>
<li><strong>Timeout feedback is critical</strong>: Users need to know WHY their hook didn't complete</li>
</ol>
<h3 id="prevention_2">Prevention<a class="headerlink" href="#prevention_2" title="Permanent link">&para;</a></h3>
<ul>
<li>Validate all hooks at installation/configuration time</li>
<li>Convert relative paths to absolute immediately</li>
<li>Set reasonable default timeouts (10s for most hooks)</li>
<li>Provide clear, actionable error messages with timeout issues</li>
</ul>
<h2 id="worktree-management-and-branch-isolation-2025-10-18">Worktree Management and Branch Isolation (2025-10-18)<a class="headerlink" href="#worktree-management-and-branch-isolation-2025-10-18" title="Permanent link">&para;</a></h2>
<h3 id="issue_3">Issue<a class="headerlink" href="#issue_3" title="Permanent link">&para;</a></h3>
<p>Multiple developers working on the same repository encountered:</p>
<ul>
<li>Lost work when switching branches</li>
<li>Confusion about which worktree was active</li>
<li>Stale worktrees cluttering filesystem</li>
<li>Difficulty tracking multiple feature branches</li>
</ul>
<h3 id="root-cause_3">Root Cause<a class="headerlink" href="#root-cause_3" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Manual worktree management</strong>: No standardized process for creating/managing worktrees</li>
<li><strong>No visual indication</strong>: Hard to tell which worktree you're in</li>
<li><strong>No cleanup process</strong>: Worktrees persisted after branches merged</li>
<li><strong>Path confusion</strong>: Similar directory names across worktrees</li>
</ol>
<h3 id="solution_3">Solution<a class="headerlink" href="#solution_3" title="Permanent link">&para;</a></h3>
<p><strong>Worktree manager agent</strong> with standardized workflow:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Create worktree with standard naming</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>git<span class="w"> </span>worktree<span class="w"> </span>add<span class="w"> </span>./worktrees/feat/issue-123-feature-name<span class="w"> </span>-b<span class="w"> </span>feat/issue-123-feature-name
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># Clear visual indication in prompt</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PS1</span><span class="o">=</span><span class="s2">&quot;[worktree: feat/issue-123] </span>$<span class="s2"> &quot;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="c1"># Cleanup merged worktrees</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>git<span class="w"> </span>worktree<span class="w"> </span>prune
</code></pre></div>
<p><strong>Standard worktree structure</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>./worktrees/
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a> feat/
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    issue-123-feature-name/
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    issue-456-other-feature/
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a> fix/
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    issue-789-bug-fix/
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a> docs/
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>     issue-101-documentation/
</code></pre></div>
<h3 id="key-learnings_3">Key Learnings<a class="headerlink" href="#key-learnings_3" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Worktrees enable parallel development</strong>: Work on multiple features without branch switching</li>
<li><strong>Naming consistency matters</strong>: Standard format makes navigation easier</li>
<li><strong>Regular cleanup prevents clutter</strong>: Prune merged worktrees regularly</li>
<li><strong>Visual indicators prevent confusion</strong>: Show current worktree in prompt or status line</li>
</ol>
<h3 id="prevention_3">Prevention<a class="headerlink" href="#prevention_3" title="Permanent link">&para;</a></h3>
<ul>
<li>Use worktree-manager agent for all worktree operations</li>
<li>Follow standard naming convention: <code>./worktrees/{type}/issue-{num}-{desc}/</code></li>
<li>Prune worktrees after merging branches</li>
<li>Configure shell prompt to show current worktree</li>
</ul>
<h2 id="context-preservation-across-sessions-2025-10-15">Context Preservation Across Sessions (2025-10-15)<a class="headerlink" href="#context-preservation-across-sessions-2025-10-15" title="Permanent link">&para;</a></h2>
<h3 id="issue_4">Issue<a class="headerlink" href="#issue_4" title="Permanent link">&para;</a></h3>
<p>Long-running tasks or multi-session projects lost important context between Claude Code sessions, requiring users to re-explain decisions, constraints, and project history.</p>
<h3 id="root-cause_4">Root Cause<a class="headerlink" href="#root-cause_4" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>No session state persistence</strong>: Each session started fresh with only basic context</li>
<li><strong>Decision rationale lost</strong>: Why certain approaches were chosen wasn't captured</li>
<li><strong>No continuation mechanism</strong>: Difficult to resume incomplete work from previous sessions</li>
<li><strong>Context spread across many files</strong>: Important information scattered in various docs</li>
</ol>
<h3 id="solution_4">Solution<a class="headerlink" href="#solution_4" title="Permanent link">&para;</a></h3>
<p><strong>Session continuation system</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="gh"># ai_working/session_state.md</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="gu">## Current Task</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>[Description of what we&#39;re working on]
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="gu">## Recent Decisions</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="k">-</span><span class="w"> </span>[Date] Chose approach X over Y because [rationale]
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="k">-</span><span class="w"> </span>[Date] Decided to defer Z until [condition]
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="gu">## Next Steps</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="k">1.</span> [What needs to happen next]
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="k">2.</span> [Dependencies or blockers]
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="gu">## Important Context</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>[Key information that must be preserved]
</code></pre></div>
<p><strong>Agent prompts reference session state</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Before starting any task, read @ai_working/session_state.md to understand:
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>- What we&#39;re currently working on
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>- Recent decisions and their rationale
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>- What the next steps are
</code></pre></div>
<h3 id="key-learnings_4">Key Learnings<a class="headerlink" href="#key-learnings_4" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Explicit state management beats implicit</strong>: Write down decisions and context</li>
<li><strong>Rationale is as important as the decision</strong>: Capture WHY, not just WHAT</li>
<li><strong>Next steps guide continuation</strong>: Clear next actions enable easy resumption</li>
<li><strong>Centralized state prevents duplication</strong>: Single source of truth for session context</li>
</ol>
<h3 id="prevention_4">Prevention<a class="headerlink" href="#prevention_4" title="Permanent link">&para;</a></h3>
<ul>
<li>Update session_state.md after major decisions or milestone completion</li>
<li>Include rationale for all non-obvious choices</li>
<li>Review session_state.md at the start of each session</li>
<li>Reference it in agent prompts and CLAUDE.md</li>
</ul>
<h2 id="philosophy-violations-in-generated-code-2025-10-12">Philosophy Violations in Generated Code (2025-10-12)<a class="headerlink" href="#philosophy-violations-in-generated-code-2025-10-12" title="Permanent link">&para;</a></h2>
<h3 id="issue_5">Issue<a class="headerlink" href="#issue_5" title="Permanent link">&para;</a></h3>
<p>Agents frequently generated code that violated amplihack's core philosophy principles:</p>
<ul>
<li>Placeholder functions with TODO comments</li>
<li>Overly complex abstractions for simple operations</li>
<li>Generic "future-proof" code for hypothetical requirements</li>
<li>Swallowed exceptions hiding real errors</li>
</ul>
<h3 id="root-cause_5">Root Cause<a class="headerlink" href="#root-cause_5" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Philosophy not enforced in agent prompts</strong>: Agents didn't consistently reference PHILOSOPHY.md</li>
<li><strong>No validation gate</strong>: Generated code not checked for philosophy compliance</li>
<li><strong>Patterns vs principles confusion</strong>: Agents applied "best practices" that contradicted philosophy</li>
<li><strong>Cleanup agent too gentle</strong>: Didn't aggressively remove unnecessary complexity</li>
</ol>
<h3 id="solution_5">Solution<a class="headerlink" href="#solution_5" title="Permanent link">&para;</a></h3>
<p><strong>Mandatory philosophy check in workflow</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="gu">### Step 6: Refactor and Simplify</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">- [ ]</span> <span class="gs">**CRITICAL: Provide cleanup agent with original user requirements**</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="k">- [ ]</span> <span class="gs">**Always use**</span> cleanup agent for ruthless simplification WITHIN user constraints
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="k">- [ ]</span> Remove unnecessary abstractions (that weren&#39;t explicitly requested)
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="k">- [ ]</span> Eliminate dead code (unless user explicitly wanted it)
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">- [ ]</span> Verify no placeholders remain - no stubs, no TODOs, no swallowed exceptions
</code></pre></div>
<p><strong>Enhanced cleanup agent prompt</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>PHILOSOPHY ENFORCEMENT CHECKLIST:
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a> No TODO comments or placeholder functions
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a> No swallowed exceptions (bare except: pass)
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a> No unimplemented functions
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a> No overly generic abstractions
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a> Simple, direct implementations
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a> Explicit error handling
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a> Single responsibility per module
</code></pre></div>
<h3 id="key-learnings_5">Key Learnings<a class="headerlink" href="#key-learnings_5" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Philosophy must be in agent context</strong>: Reference PHILOSOPHY.md in every agent prompt</li>
<li><strong>Validation gates catch violations</strong>: Check generated code before accepting it</li>
<li><strong>Be specific about anti-patterns</strong>: Tell agents what NOT to do</li>
<li><strong>Cleanup is aggressive simplification</strong>: Remove complexity, don't just organize it</li>
</ol>
<h3 id="prevention_5">Prevention<a class="headerlink" href="#prevention_5" title="Permanent link">&para;</a></h3>
<ul>
<li>Include PHILOSOPHY.md reference in all agent prompts</li>
<li>Run cleanup agent with explicit philosophy checklist</li>
<li>Review generated code for common violations (TODOs, swallowed exceptions)</li>
<li>Fail PR if philosophy violations detected</li>
</ul>
<h2 id="rate-limiting-and-token-budget-management-2025-10-08">Rate Limiting and Token Budget Management (2025-10-08)<a class="headerlink" href="#rate-limiting-and-token-budget-management-2025-10-08" title="Permanent link">&para;</a></h2>
<h3 id="issue_6">Issue<a class="headerlink" href="#issue_6" title="Permanent link">&para;</a></h3>
<p>High-frequency agent operations hit Claude API rate limits, causing:</p>
<ul>
<li>Failed tool calls with cryptic 429 errors</li>
<li>Degraded user experience with unexplained delays</li>
<li>Wasted tokens on retry attempts</li>
<li>Session crashes from unhandled rate limit errors</li>
</ul>
<h3 id="root-cause_6">Root Cause<a class="headerlink" href="#root-cause_6" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>No rate limit awareness</strong>: System didn't track API usage or respect limits</li>
<li><strong>Aggressive retry logic</strong>: Immediate retries worsened rate limit violations</li>
<li><strong>No user feedback</strong>: Rate limit errors looked like random failures</li>
<li><strong>Unbounded parallel requests</strong>: Multiple agents could overwhelm API simultaneously</li>
</ol>
<h3 id="solution_6">Solution<a class="headerlink" href="#solution_6" title="Permanent link">&para;</a></h3>
<p><strong>Rate limit protection system</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">RateLimitProtection</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requests_per_minute</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rpm_limit</span> <span class="o">=</span> <span class="n">requests_per_minute</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>        <span class="c1"># Wait if we&#39;re at rate limit</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpm_limit</span><span class="p">:</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>            <span class="n">wait_time</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">-</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>            <span class="k">if</span> <span class="n">wait_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
</code></pre></div>
<p><strong>Exponential backoff with jitter</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">exponential_backoff</span><span class="p">(</span><span class="n">attempt</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="n">base_delay</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="n">jitter</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">base_delay</span><span class="p">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">base_delay</span> <span class="o">+</span> <span class="n">jitter</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># Cap at 60s</span>
</code></pre></div>
<h3 id="key-learnings_6">Key Learnings<a class="headerlink" href="#key-learnings_6" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Rate limits are real</strong>: Respect API limits or face cascading failures</li>
<li><strong>Exponential backoff prevents thundering herd</strong>: Don't retry immediately</li>
<li><strong>User feedback prevents confusion</strong>: Explain why there's a delay</li>
<li><strong>Track usage proactively</strong>: Don't wait for 429 to learn you're over limit</li>
</ol>
<h3 id="prevention_6">Prevention<a class="headerlink" href="#prevention_6" title="Permanent link">&para;</a></h3>
<ul>
<li>Implement rate limiting for all API-heavy operations</li>
<li>Use exponential backoff with jitter for retries</li>
<li>Display clear messages when rate limited</li>
<li>Monitor token usage to stay within budget</li>
</ul>
<hr />
<h2 id="how-to-use-this-file">How to Use This File<a class="headerlink" href="#how-to-use-this-file" title="Permanent link">&para;</a></h2>
<h3 id="when-to-add-an-entry">When to Add an Entry<a class="headerlink" href="#when-to-add-an-entry" title="Permanent link">&para;</a></h3>
<p>Add a discovery when you encounter:</p>
<ul>
<li>A non-obvious problem that took significant time to diagnose</li>
<li>A solution that contradicts common assumptions</li>
<li>A pattern that prevents an entire class of issues</li>
<li>Learning that will benefit future development</li>
</ul>
<h3 id="entry-template">Entry Template<a class="headerlink" href="#entry-template" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="gu">## Problem Title (YYYY-MM-DD)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="gu">### Issue</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>[Clear description of the problem and its symptoms]
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="gu">### Root Cause</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>[What actually caused the issue - dig deep]
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="gu">### Solution</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>[What you implemented to fix it - include code examples]
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="gu">### Key Learnings</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>[Principles and insights from this experience]
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="gu">### Prevention</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>[How to avoid this problem in the future]
</code></pre></div>
<h3 id="maintenance">Maintenance<a class="headerlink" href="#maintenance" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Monthly review</strong>: Check if discoveries are still relevant</li>
<li><strong>Remove outdated entries</strong>: If better solutions exist or the problem is obsolete</li>
<li><strong>Update evolved practices</strong>: Refine solutions as understanding improves</li>
<li><strong>Link from docs</strong>: Reference relevant discoveries in CLAUDE.md and AGENTS.md</li>
</ul>
<h3 id="integration">Integration<a class="headerlink" href="#integration" title="Permanent link">&para;</a></h3>
<p>This file should be referenced by:</p>
<ul>
<li><strong>CLAUDE.md</strong>: "Before solving complex problems, check @docs/DISCOVERIES.md"</li>
<li><strong>AGENTS.md</strong>: "Review @docs/DISCOVERIES.md to avoid known pitfalls"</li>
<li><strong>New developers</strong>: "Read DISCOVERIES.md to understand institutional knowledge"</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "search.suggest", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>