
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AI-powered development framework for Claude Code">
      
      
      
        <link rel="canonical" href="https://rysweet.github.io/MicrosoftHackathon2025-AgenticCoding/research/neo4j_memory_system/04-external-knowledge/EXTERNAL_KNOWLEDGE_NEO4J_DESIGN/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>External Knowledge Integration for Neo4j Memory Graph - amplihack</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#external-knowledge-integration-for-neo4j-memory-graph" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="amplihack" class="md-header__button md-logo" aria-label="amplihack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            amplihack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              External Knowledge Integration for Neo4j Memory Graph
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/rysweet/MicrosoftHackathon2025-AgenticCoding" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    amplihack
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../PREREQUISITES/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../PHILOSOPHY/" class="md-tabs__link">
          
  
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../AUTO_MODE/" class="md-tabs__link">
          
  
  
  Features

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../DEVELOPING_AMPLIHACK/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../BENCHMARKING/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="amplihack" class="md-nav__button md-logo" aria-label="amplihack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    amplihack
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rysweet/MicrosoftHackathon2025-AgenticCoding" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    amplihack
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PREREQUISITES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../AUTO_MODE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PROXY_CONFIG_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PHILOSOPHY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Philosophy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../WORKFLOW_COMPLETION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../AUTO_MODE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../agent-bundle-generator-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Bundles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../document_driven_development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Document-Driven Development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../features/power-steering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Power-Steering Mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../features/power-steering/customization-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Power-Steering Customization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../DEVELOPING_AMPLIHACK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../IMPLEMENTATION_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../CREATE_YOUR_OWN_TOOLS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../BENCHMARKING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmarking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../DISCOVERIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Discoveries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#executive-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Executive Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Philosophy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Philosophy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#start-simple-scale-smart" class="md-nav__link">
    <span class="md-ellipsis">
      
        Start Simple, Scale Smart
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-graph-schema-design" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Graph Schema Design
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Graph Schema Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Node Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relationships" class="md-nav__link">
    <span class="md-ellipsis">
      
        Relationships
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-external-knowledge-sources" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. External Knowledge Sources
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. External Knowledge Sources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tier-1-official-documentation-highest-priority" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 1: Official Documentation (Highest Priority)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-2-curated-tutorials-medium-priority" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 2: Curated Tutorials (Medium Priority)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-3-community-knowledge-advisory-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 3: Community Knowledge (Advisory Only)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tier-4-library-specific-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tier 4: Library-Specific Knowledge
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-caching-vs-on-demand-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Caching vs. On-Demand Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Caching vs. On-Demand Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decision-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      
        Decision Matrix
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caching-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Caching Implementation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-fetch-on-demand" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Fetch On-Demand
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-linking-external-knowledge-to-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Linking External Knowledge to Code
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Linking External Knowledge to Code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-linking-simple-heuristics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic Linking (Simple Heuristics)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-linking-agent-driven" class="md-nav__link">
    <span class="md-ellipsis">
      
        Manual Linking (Agent-Driven)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-version-tracking-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Version Tracking Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Version Tracking Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#version-aware-querying" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version-Aware Querying
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-metadata-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version Metadata Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-ranking-relevance" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Ranking &amp; Relevance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Ranking &amp; Relevance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source-credibility-scoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Source Credibility Scoring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#learning-which-sources-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        Learning Which Sources Work
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-retrieval-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Retrieval Strategies
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Retrieval Strategies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-query-external-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Query External Knowledge
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-project-memory-external-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      
        Combining Project Memory + External Knowledge
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-keeping-knowledge-up-to-date" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Keeping Knowledge Up-to-Date
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. Keeping Knowledge Up-to-Date">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#refresh-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Refresh Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deprecation-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deprecation Detection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-handling-large-external-knowledge-bases" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Handling Large External Knowledge Bases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. Handling Large External Knowledge Bases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#problem-100k-documents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem: 100k+ Documents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-only-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata-Only Storage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        10. Performance Considerations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Performance Considerations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-performance-targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Performance Targets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimization-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization Strategies
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-integration-code-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        11. Integration Code Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="11. Integration Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-agent-queries-external-knowledge" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Agent Queries External Knowledge
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-automatic-api-documentation-linking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Automatic API Documentation Linking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-error-driven-knowledge-fetching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Error-Driven Knowledge Fetching
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-progressive-implementation-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        12. Progressive Implementation Plan
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="12. Progressive Implementation Plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-foundation-week-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Foundation (Week 1)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-integration-week-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Integration (Week 2)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-multiple-sources-week-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Multiple Sources (Week 3)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-optimization-week-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Optimization (Week 4)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-learning-week-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: Learning (Week 5)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#13-success-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        13. Success Metrics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="13. Success Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quality-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quality Metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#14-monitoring-maintenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        14. Monitoring &amp; Maintenance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="14. Monitoring &amp; Maintenance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#daily-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Daily Operations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weekly-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weekly Analysis
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#15-key-principles-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        15. Key Principles (Summary)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-locations" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Locations
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="external-knowledge-integration-for-neo4j-memory-graph">External Knowledge Integration for Neo4j Memory Graph<a class="headerlink" href="#external-knowledge-integration-for-neo4j-memory-graph" title="Permanent link">&para;</a></h1>
<p><strong>Design Document - November 2025</strong></p>
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="Permanent link">&para;</a></h2>
<p>This document outlines strategies for integrating external knowledge sources (API docs, developer guides, library references) into the Neo4j memory graph for coding agents. The design follows the project's ruthless simplicity philosophy: <strong>start simple, measure, optimize based on need</strong>.</p>
<h2 id="core-philosophy">Core Philosophy<a class="headerlink" href="#core-philosophy" title="Permanent link">&para;</a></h2>
<h3 id="start-simple-scale-smart">Start Simple, Scale Smart<a class="headerlink" href="#start-simple-scale-smart" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Phase 1: File-based cache (TODAY)
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    ↓
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>Phase 2: Hybrid (cache + Neo4j references) (MEASURE FIRST)
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    ↓
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>Phase 3: Full graph integration (ONLY IF NEEDED)
</code></pre></div>
<p><strong>Golden Rule</strong>: External knowledge is ADVISORY. Project-specific memory always takes precedence.</p>
<hr />
<h2 id="1-graph-schema-design">1. Graph Schema Design<a class="headerlink" href="#1-graph-schema-design" title="Permanent link">&para;</a></h2>
<h3 id="node-types">Node Types<a class="headerlink" href="#node-types" title="Permanent link">&para;</a></h3>
<h4 id="externaldoc-node">ExternalDoc Node<a class="headerlink" href="#externaldoc-node" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">                  </span><span class="c1">// Unique identifier</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="n">source</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">              </span><span class="c1">// &quot;ms_learn&quot; | &quot;python_docs&quot; | &quot;mdn&quot; | &quot;stackoverflow&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="n">source_url</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">          </span><span class="c1">// Original URL</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">               </span><span class="c1">// Document title</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">content_hash</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">        </span><span class="c1">// SHA256 of content (for change detection)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="n">summary</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">             </span><span class="c1">// AI-generated summary (200-500 chars)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="n">content_snippet</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">     </span><span class="c1">// First 1000 chars or key excerpt</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="n">last_updated</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">      </span><span class="c1">// When we fetched it</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="n">last_accessed</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span><span class="p">,</span><span class="w">     </span><span class="c1">// When agent used it</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="n">access_count</span><span class="p">:</span><span class="w"> </span><span class="n">integer</span><span class="p">,</span><span class="w">       </span><span class="c1">// Usage tracking</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="n">relevance_score</span><span class="p">:</span><span class="w"> </span><span class="n">float</span><span class="p">,</span><span class="w">      </span><span class="c1">// 0.0-1.0 based on usage patterns</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">    </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">             </span><span class="c1">// e.g., &quot;Python 3.12&quot;, &quot;Node 20&quot;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="n">language</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">            </span><span class="c1">// Programming language</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">            </span><span class="c1">// &quot;api&quot; | &quot;tutorial&quot; | &quot;reference&quot; | &quot;guide&quot;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="n">fetch_method</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="w">         </span><span class="c1">// &quot;cache&quot; | &quot;api&quot; | &quot;web_scrape&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="p">})</span>
</code></pre></div>
<h4 id="apireference-node">APIReference Node<a class="headerlink" href="#apireference-node" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">namespace</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">           </span><span class="c1">// e.g., &quot;azure.storage.blob&quot;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="n">function_name</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">       </span><span class="c1">// e.g., &quot;BlobServiceClient.create_container&quot;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="n">signature</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">           </span><span class="c1">// Full function signature</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="n">parameters</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">          </span><span class="c1">// JSON array of parameters</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="n">return_type</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="n">example_code</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">        </span><span class="c1">// Working code example</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="n">common_patterns</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">     </span><span class="c1">// JSON array of usage patterns</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="n">gotchas</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">             </span><span class="c1">// Common pitfalls (JSON array)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="n">version_introduced</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="n">deprecated_in</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">       </span><span class="c1">// null if not deprecated</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="n">source_doc_id</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="w">        </span><span class="c1">// Link to full documentation</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="p">})</span>
</code></pre></div>
<h4 id="bestpractice-node">BestPractice Node<a class="headerlink" href="#bestpractice-node" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">bp</span><span class="p">:</span><span class="n">BestPractice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="n">domain</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">              </span><span class="c1">// &quot;authentication&quot; | &quot;async&quot; | &quot;security&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="n">when_to_use</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="n">when_not_to_use</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="n">example_code</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="n">anti_patterns</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">       </span><span class="c1">// JSON array of what NOT to do</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="n">related_apis</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">        </span><span class="c1">// JSON array of API references</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="n">confidence_score</span><span class="p">:</span><span class="w"> </span><span class="n">float</span><span class="p">,</span><span class="w">     </span><span class="c1">// 0.0-1.0 based on source credibility</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="n">source_count</span><span class="p">:</span><span class="w"> </span><span class="n">integer</span><span class="p">,</span><span class="w">       </span><span class="c1">// How many sources agree</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="n">last_validated</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="p">})</span>
</code></pre></div>
<h4 id="codeexample-node">CodeExample Node<a class="headerlink" href="#codeexample-node" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="p">:</span><span class="n">CodeExample</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="n">language</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="n">framework</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">           </span><span class="c1">// Optional: &quot;Flask&quot; | &quot;FastAPI&quot; | &quot;Django&quot;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">                </span><span class="c1">// Full working example</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="n">explanation</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="n">use_case</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="n">difficulty</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">          </span><span class="c1">// &quot;beginner&quot; | &quot;intermediate&quot; | &quot;advanced&quot;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="n">execution_time_ms</span><span class="p">:</span><span class="w"> </span><span class="n">integer</span><span class="p">,</span><span class="w">  </span><span class="c1">// Performance metric if available</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="n">dependencies</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">        </span><span class="c1">// JSON array of required packages</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="n">works_with_version</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w">  </span><span class="c1">// Version compatibility</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">    </span><span class="n">upvotes</span><span class="p">:</span><span class="w"> </span><span class="n">integer</span><span class="p">,</span><span class="w">            </span><span class="c1">// If from StackOverflow/GitHub</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="n">source_url</span><span class="p">:</span><span class="w"> </span><span class="n">string</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="p">})</span>
</code></pre></div>
<h3 id="relationships">Relationships<a class="headerlink" href="#relationships" title="Permanent link">&para;</a></h3>
<h4 id="between-external-knowledge-and-code">Between External Knowledge and Code<a class="headerlink" href="#between-external-knowledge-and-code" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">// Link to project code</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">EXPLAINS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">CodeFile</span><span class="p">)</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">USED_IN</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">func</span><span class="p">:</span><span class="n">Function</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">(</span><span class="n">bp</span><span class="p">:</span><span class="n">BestPractice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">APPLIED_IN</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">CodeFile</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="p">(</span><span class="n">ex</span><span class="p">:</span><span class="n">CodeExample</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">SIMILAR_TO</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">func</span><span class="p">:</span><span class="n">Function</span><span class="p">)</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c1">// Knowledge hierarchy</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">DOCUMENTED_IN</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="p">(</span><span class="n">bp</span><span class="p">:</span><span class="n">BestPractice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">REFERENCES</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="p">(</span><span class="n">ex</span><span class="p">:</span><span class="n">CodeExample</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">DEMONSTRATES</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="p">(</span><span class="n">ex</span><span class="p">:</span><span class="n">CodeExample</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">IMPLEMENTS</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">bp</span><span class="p">:</span><span class="n">BestPractice</span><span class="p">)</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="c1">// Cross-references</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">RELATED_TO</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">doc2</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="p">)</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">ALTERNATIVE_TO</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">api2</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="p">(</span><span class="n">bp</span><span class="p">:</span><span class="n">BestPractice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">CONFLICTS_WITH</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">bp2</span><span class="p">:</span><span class="n">BestPractice</span><span class="p">)</span>
</code></pre></div>
<h4 id="version-tracking">Version Tracking<a class="headerlink" href="#version-tracking" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">// Version relationships</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">VERSION_OF</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">api_v2</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">SUPERSEDES</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">doc_old</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="p">)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1">// Compatibility tracking</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">COMPATIBLE_WITH</span><span class="w"> </span><span class="p">{</span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.12&quot;</span><span class="p">}</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">lang</span><span class="p">:</span><span class="n">Language</span><span class="p">)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">(</span><span class="n">bp</span><span class="p">:</span><span class="n">BestPractice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">DEPRECATED_IN</span><span class="w"> </span><span class="p">{</span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4.0&quot;</span><span class="p">}</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">framework</span><span class="p">:</span><span class="n">Framework</span><span class="p">)</span>
</code></pre></div>
<h4 id="source-credibility">Source Credibility<a class="headerlink" href="#source-credibility" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">// Source credibility metadata</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="n">ExternalDoc</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">SOURCED_FROM</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">source</span><span class="p">:</span><span class="n">Source</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Microsoft Learn&quot;</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="n">trust_score</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="p">.</span><span class="m">95</span><span class="p">,</span><span class="w">         </span><span class="c1">// Official docs = high trust</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="n">last_verified</span><span class="p">:</span><span class="w"> </span><span class="n">datetime</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">})</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="p">(</span><span class="n">ex</span><span class="p">:</span><span class="n">CodeExample</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">SOURCED_FROM</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">source</span><span class="p">:</span><span class="n">Source</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;StackOverflow&quot;</span><span class="p">,</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="n">trust_score</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="p">.</span><span class="m">75</span><span class="p">,</span><span class="w">         </span><span class="c1">// Community = medium trust</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="n">answer_accepted</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="n">upvotes</span><span class="p">:</span><span class="w"> </span><span class="m">150</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="p">})</span>
</code></pre></div>
<hr />
<h2 id="2-external-knowledge-sources">2. External Knowledge Sources<a class="headerlink" href="#2-external-knowledge-sources" title="Permanent link">&para;</a></h2>
<h3 id="tier-1-official-documentation-highest-priority">Tier 1: Official Documentation (Highest Priority)<a class="headerlink" href="#tier-1-official-documentation-highest-priority" title="Permanent link">&para;</a></h3>
<p><strong>Sources:</strong></p>
<ul>
<li>Microsoft Learn (Azure, .NET, TypeScript)</li>
<li>Python.org official docs</li>
<li>MDN Web Docs (JavaScript, Web APIs)</li>
<li>Library-specific official docs</li>
</ul>
<p><strong>Characteristics:</strong></p>
<ul>
<li>High credibility (trust_score: 0.9-1.0)</li>
<li>Version-specific</li>
<li>Regularly updated</li>
<li>Comprehensive</li>
</ul>
<p><strong>Fetch Strategy:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_official_docs</span><span class="p">(</span><span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExternalDoc</span><span class="p">:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="sd">    Fetch official documentation with caching.</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="sd">    Priority:</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="sd">    1. Check local cache (&lt; 7 days old)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="sd">    2. Fetch from official API if available</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="sd">    3. Web scrape documentation site</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="sd">    4. Fallback to cached version (even if stale)</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>    <span class="n">cache_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;~/.amplihack/external_knowledge/</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>    <span class="c1"># Check cache first</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    <span class="k">if</span> <span class="n">cache_exists</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cache_age_days</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>        <span class="k">return</span> <span class="n">load_from_cache</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    <span class="c1"># Fetch from source</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">fetch_from_official_source</span><span class="p">(</span><span class="n">package_name</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>        <span class="n">save_to_cache</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>        <span class="k">return</span> <span class="n">doc</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    <span class="k">except</span> <span class="n">FetchError</span><span class="p">:</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>        <span class="c1"># Graceful degradation: use stale cache</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>        <span class="k">return</span> <span class="n">load_from_cache</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">cache_exists</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="tier-2-curated-tutorials-medium-priority">Tier 2: Curated Tutorials (Medium Priority)<a class="headerlink" href="#tier-2-curated-tutorials-medium-priority" title="Permanent link">&para;</a></h3>
<p><strong>Sources:</strong></p>
<ul>
<li>Real Python</li>
<li>FreeCodeCamp</li>
<li>Official framework tutorials</li>
<li>Microsoft sample code repositories</li>
</ul>
<p><strong>Characteristics:</strong></p>
<ul>
<li>High quality (trust_score: 0.7-0.9)</li>
<li>Practical, working examples</li>
<li>Often more accessible than official docs</li>
<li>May lag behind latest versions</li>
</ul>
<p><strong>Fetch Strategy:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_tutorial_knowledge</span><span class="p">(</span><span class="n">topic</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExternalDoc</span><span class="p">]:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="sd">    Fetch curated tutorials with quality filtering.</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="sd">    Filter criteria:</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="sd">    - Published within last 2 years</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="sd">    - Author has track record (check source credibility)</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="sd">    - Code examples compile/run</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="sd">    - Clear explanations</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">candidates</span> <span class="o">=</span> <span class="n">search_tutorial_sources</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">quality_score</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">]</span>
</code></pre></div>
<h3 id="tier-3-community-knowledge-advisory-only">Tier 3: Community Knowledge (Advisory Only)<a class="headerlink" href="#tier-3-community-knowledge-advisory-only" title="Permanent link">&para;</a></h3>
<p><strong>Sources:</strong></p>
<ul>
<li>StackOverflow (accepted answers with high upvotes)</li>
<li>GitHub issues (maintainer responses)</li>
<li>Reddit r/programming (highly upvoted)</li>
</ul>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Variable quality (trust_score: 0.4-0.8)</li>
<li>Often practical, real-world solutions</li>
<li>Version compatibility may vary</li>
<li>Require validation</li>
</ul>
<p><strong>Fetch Strategy:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_community_knowledge</span><span class="p">(</span><span class="n">error_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">CodeExample</span><span class="p">]:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="sd">    Fetch community solutions with strict filtering.</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="sd">    Only include:</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="sd">    - StackOverflow: Accepted answer + 10+ upvotes</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="sd">    - GitHub: Maintainer comment or closed issue</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="sd">    - Must have code example</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="sd">    - Must be &lt;2 years old or version-agnostic</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="c1"># StackOverflow</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="n">so_results</span> <span class="o">=</span> <span class="n">search_stackoverflow</span><span class="p">(</span><span class="n">error_pattern</span><span class="p">)</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>    <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">so_results</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">accepted</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">upvotes</span> <span class="o">&gt;=</span> <span class="mi">10</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    <span class="p">])</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>    <span class="c1"># GitHub issues</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>    <span class="n">gh_results</span> <span class="o">=</span> <span class="n">search_github_issues</span><span class="p">(</span><span class="n">error_pattern</span><span class="p">)</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>    <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>        <span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">gh_results</span>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">author_is_maintainer</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;closed&quot;</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>    <span class="p">])</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<h3 id="tier-4-library-specific-knowledge">Tier 4: Library-Specific Knowledge<a class="headerlink" href="#tier-4-library-specific-knowledge" title="Permanent link">&para;</a></h3>
<p><strong>Sources:</strong></p>
<ul>
<li>PyPI package documentation</li>
<li>NPM package README</li>
<li>Library changelog and migration guides</li>
</ul>
<p><strong>Fetch Strategy:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">fetch_library_knowledge</span><span class="p">(</span><span class="n">package</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="sd">    Fetch library-specific knowledge from package registries.</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="sd">    Data extracted:</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="sd">    - README (installation, quick start)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="sd">    - API reference (if available)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="sd">    - CHANGELOG (breaking changes, new features)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="sd">    - Common usage patterns from examples/</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="n">registry_data</span> <span class="o">=</span> <span class="n">fetch_from_registry</span><span class="p">(</span><span class="n">package</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>        <span class="s2">&quot;readme&quot;</span><span class="p">:</span> <span class="n">extract_readme</span><span class="p">(</span><span class="n">registry_data</span><span class="p">),</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>        <span class="s2">&quot;api_reference&quot;</span><span class="p">:</span> <span class="n">extract_api_docs</span><span class="p">(</span><span class="n">registry_data</span><span class="p">),</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>        <span class="s2">&quot;changelog&quot;</span><span class="p">:</span> <span class="n">extract_changelog</span><span class="p">(</span><span class="n">registry_data</span><span class="p">),</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>        <span class="s2">&quot;examples&quot;</span><span class="p">:</span> <span class="n">extract_examples</span><span class="p">(</span><span class="n">registry_data</span><span class="p">)</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    <span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="3-caching-vs-on-demand-strategy">3. Caching vs. On-Demand Strategy<a class="headerlink" href="#3-caching-vs-on-demand-strategy" title="Permanent link">&para;</a></h2>
<h3 id="decision-matrix">Decision Matrix<a class="headerlink" href="#decision-matrix" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Knowledge Type</th>
<th>Cache Strategy</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Official API docs</td>
<td><strong>Cache + Refresh</strong></td>
<td>Stable, frequently used, version-specific</td>
</tr>
<tr>
<td>Tutorials</td>
<td><strong>Cache Long-term</strong></td>
<td>Don't change often, high value</td>
</tr>
<tr>
<td>StackOverflow</td>
<td><strong>On-demand + Short cache</strong></td>
<td>Dynamic, context-dependent</td>
</tr>
<tr>
<td>Library READMEs</td>
<td><strong>Cache + Version-aware</strong></td>
<td>Stable per version</td>
</tr>
<tr>
<td>Best practices</td>
<td><strong>Cache + Periodic refresh</strong></td>
<td>Evolve slowly</td>
</tr>
</tbody>
</table>
<h3 id="caching-implementation">Caching Implementation<a class="headerlink" href="#caching-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExternalKnowledgeCache</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="sd">    Simple file-based cache with TTL and version awareness.</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="sd">    Philosophy: Files are simple, versionable, inspectable.</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="sd">    Don&#39;t use a database until you measure the need.</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;.amplihack&quot;</span> <span class="o">/</span> <span class="s2">&quot;external_knowledge&quot;</span><span class="p">):</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">cache_dir</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="mo">0o700</span><span class="p">)</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate cache file path.&quot;&quot;&quot;</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>            <span class="n">key</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.json&quot;</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_age_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get from cache if fresh enough.&quot;&quot;&quot;</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>        <span class="n">cache_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_key</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>        <span class="c1"># Check age</span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>        <span class="n">age_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">cache_file</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">))</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>        <span class="k">if</span> <span class="n">age_days</span> <span class="o">&gt;</span> <span class="n">max_age_days</span><span class="p">:</span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>        <span class="k">with</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Save to cache.&quot;&quot;&quot;</span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>        <span class="n">cache_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_key</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>        <span class="n">cache_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>
<a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>        <span class="k">with</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a>
<a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a>        <span class="c1"># Secure permissions</span>
<a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>        <span class="n">cache_file</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="mo">0o600</span><span class="p">)</span>
</code></pre></div>
<h3 id="when-to-fetch-on-demand">When to Fetch On-Demand<a class="headerlink" href="#when-to-fetch-on-demand" title="Permanent link">&para;</a></h3>
<p><strong>Fetch on-demand for:</strong></p>
<ul>
<li>Error-specific solutions (context-dependent)</li>
<li>Rare API usage (&lt; 5% of queries)</li>
<li>Rapidly changing content (beta features)</li>
<li>User-initiated searches</li>
</ul>
<p><strong>Pre-cache for:</strong></p>
<ul>
<li>Common APIs (used in &gt; 10% of projects)</li>
<li>Core language features</li>
<li>Framework essentials</li>
<li>Known problem areas</li>
</ul>
<hr />
<h2 id="4-linking-external-knowledge-to-code">4. Linking External Knowledge to Code<a class="headerlink" href="#4-linking-external-knowledge-to-code" title="Permanent link">&para;</a></h2>
<h3 id="automatic-linking-simple-heuristics">Automatic Linking (Simple Heuristics)<a class="headerlink" href="#automatic-linking-simple-heuristics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">link_external_knowledge_to_code</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">CodeFile</span><span class="p">,</span> <span class="n">external_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ExternalDoc</span><span class="p">]):</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="sd">    Link external knowledge to code files using simple heuristics.</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="sd">    Match criteria:</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="sd">    1. Import statements → Library documentation</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="sd">    2. API calls → API reference docs</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="sd">    3. Error patterns → Solution examples</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="sd">    4. Code patterns → Best practices</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    <span class="c1"># Extract imports</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="n">imports</span> <span class="o">=</span> <span class="n">extract_imports</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>    <span class="k">for</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">imports</span><span class="p">:</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="n">matching_docs</span> <span class="o">=</span> <span class="n">find_docs_for_package</span><span class="p">(</span><span class="n">imp</span><span class="o">.</span><span class="n">package_name</span><span class="p">)</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">matching_docs</span><span class="p">:</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>            <span class="n">create_relationship</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="s2">&quot;EXPLAINS&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>    <span class="c1"># Extract API calls</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>    <span class="n">api_calls</span> <span class="o">=</span> <span class="n">extract_api_calls</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>    <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">api_calls</span><span class="p">:</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>        <span class="n">matching_api_refs</span> <span class="o">=</span> <span class="n">find_api_reference</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">call</span><span class="o">.</span><span class="n">function</span><span class="p">)</span>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a>        <span class="k">for</span> <span class="n">api_ref</span> <span class="ow">in</span> <span class="n">matching_api_refs</span><span class="p">:</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>            <span class="n">create_relationship</span><span class="p">(</span><span class="n">api_ref</span><span class="p">,</span> <span class="s2">&quot;USED_IN&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>    <span class="c1"># Pattern matching</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a>    <span class="n">patterns</span> <span class="o">=</span> <span class="n">detect_code_patterns</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>        <span class="n">best_practices</span> <span class="o">=</span> <span class="n">find_best_practices</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>        <span class="k">for</span> <span class="n">bp</span> <span class="ow">in</span> <span class="n">best_practices</span><span class="p">:</span>
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>            <span class="n">create_relationship</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="s2">&quot;APPLIED_IN&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</code></pre></div>
<h3 id="manual-linking-agent-driven">Manual Linking (Agent-Driven)<a class="headerlink" href="#manual-linking-agent-driven" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">agent_link_external_knowledge</span><span class="p">(</span><span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code_context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">decision</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="sd">    Let agents explicitly link external knowledge they used.</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="sd">    When an agent says:</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="sd">    &quot;I followed the Azure Blob Storage documentation for container creation&quot;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="sd">    We extract:</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="sd">    - Source: &quot;Azure Blob Storage documentation&quot;</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="sd">    - Topic: &quot;container creation&quot;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="sd">    - Decision: &lt;agent&#39;s decision&gt;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="sd">    Then create explicit link in graph.</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    <span class="n">knowledge_references</span> <span class="o">=</span> <span class="n">extract_knowledge_references</span><span class="p">(</span><span class="n">decision</span><span class="p">)</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">knowledge_references</span><span class="p">:</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>        <span class="n">external_doc</span> <span class="o">=</span> <span class="n">find_or_fetch_external_doc</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">topic</span><span class="p">)</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        <span class="k">if</span> <span class="n">external_doc</span><span class="p">:</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>            <span class="n">create_relationship</span><span class="p">(</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>                <span class="n">external_doc</span><span class="p">,</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>                <span class="s2">&quot;INFORMED_DECISION&quot;</span><span class="p">,</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>                <span class="n">decision_node</span><span class="p">,</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>                <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;agent_id&quot;</span><span class="p">:</span> <span class="n">agent_id</span><span class="p">,</span> <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">ref</span><span class="o">.</span><span class="n">confidence</span><span class="p">}</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>            <span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="5-version-tracking-strategy">5. Version Tracking Strategy<a class="headerlink" href="#5-version-tracking-strategy" title="Permanent link">&para;</a></h2>
<h3 id="version-aware-querying">Version-Aware Querying<a class="headerlink" href="#version-aware-querying" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// Query: Find API reference for Python 3.12</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">api</span><span class="p">:</span><span class="n">APIReference</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">COMPATIBLE_WITH</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">lang</span><span class="p">:</span><span class="n">Language</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Python&quot;</span><span class="p">})</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">lang</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;3.12&quot;</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="n">version_introduced</span><span class="w"> </span><span class="p">&lt;=</span><span class="w"> </span><span class="s">&quot;3.12&quot;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="n">AND</span><span class="w"> </span><span class="p">(</span><span class="n">api</span><span class="p">.</span><span class="n">deprecated_in</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">api</span><span class="p">.</span><span class="n">deprecated_in</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="s">&quot;3.12&quot;</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">RETURN</span><span class="w"> </span><span class="n">api</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="c1">// Query: Find best practices valid for current framework version</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">bp</span><span class="p">:</span><span class="n">BestPractice</span><span class="p">)</span><span class="o">-[</span><span class="p">:</span><span class="n">APPLIES_TO</span><span class="o">]-&gt;</span><span class="p">(</span><span class="n">framework</span><span class="p">:</span><span class="n">Framework</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">framework</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;FastAPI&quot;</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">  </span><span class="n">AND</span><span class="w"> </span><span class="n">framework</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="p">&gt;=</span><span class="w"> </span><span class="n">bp</span><span class="p">.</span><span class="n">min_version</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">  </span><span class="n">AND</span><span class="w"> </span><span class="p">(</span><span class="n">bp</span><span class="p">.</span><span class="n">deprecated_in</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">OR</span><span class="w"> </span><span class="n">framework</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="n">bp</span><span class="p">.</span><span class="n">deprecated_in</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="k">RETURN</span><span class="w"> </span><span class="n">bp</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">bp</span><span class="p">.</span><span class="n">confidence_score</span><span class="w"> </span><span class="k">DESC</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="k">LIMIT</span><span class="w"> </span><span class="m">5</span>
</code></pre></div>
<h3 id="version-metadata-storage">Version Metadata Storage<a class="headerlink" href="#version-metadata-storage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">VersionedKnowledge</span><span class="p">:</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Track version-specific knowledge with deprecation.&quot;&quot;&quot;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">store_api_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Store API with version metadata.&quot;&quot;&quot;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>        <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="s2">        MERGE (api:APIReference {id: $id})</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="s2">        SET api.function_name = $function_name,</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="s2">            api.signature = $signature,</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="s2">            api.version_introduced = $version_introduced,</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="s2">            api.deprecated_in = $deprecated_in,</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="s2">            api.last_updated = datetime()</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="s2">        // Link to language version</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="s2">        MERGE (lang:Language {name: $language, version: $language_version})</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="s2">        MERGE (api)-[:COMPATIBLE_WITH]-&gt;(lang)</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="o">**</span><span class="n">api_data</span><span class="p">)</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mark_deprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deprecated_in_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">replacement</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark API as deprecated and link to replacement.&quot;&quot;&quot;</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>        <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="s2">        MATCH (old:APIReference {id: $api_id})</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="s2">        SET old.deprecated_in = $deprecated_in</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="s2">        MERGE (new:APIReference {id: $replacement_id})</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="s2">        MERGE (old)-[:REPLACED_BY {in_version: $deprecated_in}]-&gt;(new)</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>                      <span class="n">api_id</span><span class="o">=</span><span class="n">api_id</span><span class="p">,</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>                      <span class="n">deprecated_in</span><span class="o">=</span><span class="n">deprecated_in_version</span><span class="p">,</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>                      <span class="n">replacement_id</span><span class="o">=</span><span class="n">replacement</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="6-ranking-relevance">6. Ranking &amp; Relevance<a class="headerlink" href="#6-ranking-relevance" title="Permanent link">&para;</a></h2>
<h3 id="source-credibility-scoring">Source Credibility Scoring<a class="headerlink" href="#source-credibility-scoring" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">SOURCE_CREDIBILITY</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="c1"># Official sources</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="s2">&quot;microsoft_learn&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="s2">&quot;python_docs&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="s2">&quot;mdn&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="c1"># Curated content</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="s2">&quot;real_python&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="s2">&quot;official_tutorials&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    <span class="c1"># Community (filtered)</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    <span class="s2">&quot;stackoverflow_accepted&quot;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">,</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>    <span class="s2">&quot;github_maintainer&quot;</span><span class="p">:</span> <span class="mf">0.80</span><span class="p">,</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>    <span class="s2">&quot;reddit_highvote&quot;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>    <span class="c1"># Unknown/unverified</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>    <span class="s2">&quot;blog_unknown&quot;</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>    <span class="s2">&quot;forum_post&quot;</span><span class="p">:</span> <span class="mf">0.35</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="p">}</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_relevance_score</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">ExternalDoc</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="sd">    Calculate relevance score based on multiple factors.</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="sd">    Factors (weighted):</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="sd">    - Source credibility (40%)</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="sd">    - Content freshness (20%)</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="sd">    - Usage frequency (20%)</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="sd">    - Text similarity to context (20%)</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>    <span class="c1"># Base credibility</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a>    <span class="n">credibility</span> <span class="o">=</span> <span class="n">SOURCE_CREDIBILITY</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a>    <span class="c1"># Freshness score (decay over time)</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>    <span class="n">age_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">doc</span><span class="o">.</span><span class="n">last_updated</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>    <span class="n">freshness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">age_days</span> <span class="o">/</span> <span class="mf">730.0</span><span class="p">))</span>  <span class="c1"># 2-year decay</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a>    <span class="c1"># Usage score (more used = more relevant)</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>    <span class="n">usage</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">access_count</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a>    <span class="c1"># Semantic similarity (simple keyword matching for now)</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a>    <span class="n">similarity</span> <span class="o">=</span> <span class="n">calculate_text_similarity</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a>    <span class="c1"># Weighted average</span>
<a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a>    <span class="n">score</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a>        <span class="n">credibility</span> <span class="o">*</span> <span class="mf">0.40</span> <span class="o">+</span>
<a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a>        <span class="n">freshness</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">+</span>
<a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a>        <span class="n">usage</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">+</span>
<a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a>        <span class="n">similarity</span> <span class="o">*</span> <span class="mf">0.20</span>
<a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a>    <span class="p">)</span>
<a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a>
<a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a>    <span class="k">return</span> <span class="n">score</span>
</code></pre></div>
<h3 id="learning-which-sources-work">Learning Which Sources Work<a class="headerlink" href="#learning-which-sources-work" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExternalKnowledgeFeedback</span><span class="p">:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Track which external knowledge actually helped.&quot;&quot;&quot;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">record_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task_outcome</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Record when external knowledge was used and outcome.&quot;&quot;&quot;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>        <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="s2">        MATCH (doc:ExternalDoc {id: $doc_id})</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="s2">        SET doc.access_count = doc.access_count + 1,</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="s2">            doc.last_accessed = datetime()</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="s2">        // Record outcome</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="s2">        CREATE (usage:KnowledgeUsage {</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="s2">            doc_id: $doc_id,</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="s2">            agent_id: $agent_id,</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="s2">            outcome: $outcome,</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="s2">            timestamp: datetime()</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="s2">        })</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">doc_id</span><span class="o">=</span><span class="n">doc_id</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">outcome</span><span class="o">=</span><span class="n">task_outcome</span><span class="p">)</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_effective_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExternalDoc</span><span class="p">]:</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find external knowledge that led to successful outcomes.&quot;&quot;&quot;</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a>        <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="s2">        MATCH (doc:ExternalDoc {category: $domain})</span>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="s2">        OPTIONAL MATCH (doc)&lt;-[:USED]-(usage:KnowledgeUsage {outcome: &quot;success&quot;})</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="s2">        WITH doc, count(usage) as success_count</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="s2">        WHERE success_count &gt; 5</span>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="s2">        RETURN doc</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="s2">        ORDER BY success_count DESC, doc.relevance_score DESC</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="s2">        LIMIT 10</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="7-retrieval-strategies">7. Retrieval Strategies<a class="headerlink" href="#7-retrieval-strategies" title="Permanent link">&para;</a></h2>
<h3 id="when-to-query-external-knowledge">When to Query External Knowledge<a class="headerlink" href="#when-to-query-external-knowledge" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExternalKnowledgeRetriever</span><span class="p">:</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decide when and what external knowledge to retrieve.&quot;&quot;&quot;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">should_query_external</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">AgentContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="sd">        Decide if external knowledge would help.</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="sd">        Query external knowledge if:</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="sd">        1. Agent is encountering new library/API</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="sd">        2. Error pattern not in project memory</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="sd">        3. Best practice request for unfamiliar domain</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="sd">        4. User explicitly asks for documentation</span>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="sd">        Don&#39;t query if:</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="sd">        1. Project memory has sufficient context</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="sd">        2. Agent has handled this pattern before</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="sd">        3. Pure refactoring (no new APIs)</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>        <span class="c1"># Check project memory first</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>        <span class="n">project_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>            <span class="n">agent_id</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>            <span class="n">memory_type</span><span class="o">=</span><span class="n">MemoryType</span><span class="o">.</span><span class="n">PATTERN</span><span class="p">,</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>            <span class="n">search</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">current_task</span>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>        <span class="p">)</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">project_memories</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>            <span class="c1"># We have sufficient project-specific knowledge</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>        <span class="c1"># Check if task involves new APIs</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>        <span class="n">new_apis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_new_apis</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">code_context</span><span class="p">)</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>        <span class="k">if</span> <span class="n">new_apis</span><span class="p">:</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>        <span class="c1"># Check for error patterns</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">error_pattern</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_solution_in_project_memory</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">error_pattern</span><span class="p">):</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">retrieve_relevant_knowledge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">AgentContext</span><span class="p">,</span> <span class="n">max_items</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExternalDoc</span><span class="p">]:</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="sd">        Retrieve most relevant external knowledge.</span>
<a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a>
<a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a><span class="sd">        Strategy:</span>
<a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a><span class="sd">        1. Identify knowledge gaps in project memory</span>
<a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="sd">        2. Query external knowledge to fill gaps</span>
<a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a><span class="sd">        3. Rank by relevance</span>
<a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a><span class="sd">        4. Return top N items</span>
<a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a><span class="sd">        5. Cache for future use</span>
<a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a>
<a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a>        <span class="n">knowledge_gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_knowledge_gaps</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a>
<a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a>        <span class="n">external_docs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a>        <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">knowledge_gaps</span><span class="p">:</span>
<a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a>            <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_external_sources</span><span class="p">(</span>
<a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a>                <span class="n">topic</span><span class="o">=</span><span class="n">gap</span><span class="o">.</span><span class="n">topic</span><span class="p">,</span>
<a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a>                <span class="n">language</span><span class="o">=</span><span class="n">gap</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
<a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a>                <span class="n">version</span><span class="o">=</span><span class="n">gap</span><span class="o">.</span><span class="n">version</span>
<a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a>            <span class="p">)</span>
<a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a>            <span class="n">external_docs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a>
<a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a>        <span class="c1"># Rank by relevance</span>
<a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a>        <span class="n">ranked_docs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a>            <span class="n">external_docs</span><span class="p">,</span>
<a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a>            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">calculate_relevance_score</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">current_task</span><span class="p">),</span>
<a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a>            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a>        <span class="p">)</span>
<a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a>
<a id="__codelineno-19-72" name="__codelineno-19-72" href="#__codelineno-19-72"></a>        <span class="k">return</span> <span class="n">ranked_docs</span><span class="p">[:</span><span class="n">max_items</span><span class="p">]</span>
</code></pre></div>
<h3 id="combining-project-memory-external-knowledge">Combining Project Memory + External Knowledge<a class="headerlink" href="#combining-project-memory-external-knowledge" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">build_agent_context</span><span class="p">(</span><span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="sd">    Build comprehensive context from project memory + external knowledge.</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="sd">    Priority:</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="sd">    1. Project-specific memories (HIGHEST)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="sd">    2. Previously successful external knowledge</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="sd">    3. Fresh external knowledge (if gaps exist)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    <span class="n">context_parts</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>    <span class="c1"># Project memory (always first)</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>    <span class="n">project_memories</span> <span class="o">=</span> <span class="n">memory_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>        <span class="n">agent_id</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>        <span class="n">search</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>        <span class="n">min_importance</span><span class="o">=</span><span class="mi">5</span>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a>    <span class="p">)</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>    <span class="k">if</span> <span class="n">project_memories</span><span class="p">:</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a>        <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## Project-Specific Knowledge&quot;</span><span class="p">)</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a>        <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">project_memories</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>  <span class="c1"># Top 3</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>            <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">mem</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mem</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a>    <span class="c1"># External knowledge (if needed)</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>    <span class="n">context</span> <span class="o">=</span> <span class="n">AgentContext</span><span class="p">(</span><span class="n">agent_id</span><span class="o">=</span><span class="n">agent_id</span><span class="p">,</span> <span class="n">current_task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a>    <span class="k">if</span> <span class="n">external_retriever</span><span class="o">.</span><span class="n">should_query_external</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a>        <span class="n">external_docs</span> <span class="o">=</span> <span class="n">external_retriever</span><span class="o">.</span><span class="n">retrieve_relevant_knowledge</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a>        <span class="k">if</span> <span class="n">external_docs</span><span class="p">:</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a>            <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## External Reference (Advisory)&quot;</span><span class="p">)</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">external_docs</span><span class="p">:</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>                <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- [</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a>                <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">example_code</span><span class="p">:</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>                    <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Example:</span><span class="se">\n</span><span class="s2">  ```</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">example_code</span><span class="si">}</span><span class="se">\n</span><span class="s2">  ```&quot;</span><span class="p">)</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a>    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_parts</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="8-keeping-knowledge-up-to-date">8. Keeping Knowledge Up-to-Date<a class="headerlink" href="#8-keeping-knowledge-up-to-date" title="Permanent link">&para;</a></h2>
<h3 id="refresh-strategy">Refresh Strategy<a class="headerlink" href="#refresh-strategy" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ExternalKnowledgeRefresher</span><span class="p">:</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Keep external knowledge fresh without over-fetching.&quot;&quot;&quot;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="c1"># Refresh frequencies by source type</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>    <span class="n">REFRESH_INTERVALS</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>        <span class="s2">&quot;official_docs&quot;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>      <span class="c1"># Stable</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>        <span class="s2">&quot;tutorials&quot;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">),</span>           <span class="c1"># Slow-changing</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>        <span class="s2">&quot;community&quot;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>            <span class="c1"># Dynamic</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>        <span class="s2">&quot;library_specific&quot;</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>     <span class="c1"># Version-dependent</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>    <span class="p">}</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">needs_refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">ExternalDoc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if document needs refreshing.&quot;&quot;&quot;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>        <span class="n">age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">doc</span><span class="o">.</span><span class="n">last_updated</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>        <span class="n">interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REFRESH_INTERVALS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>        <span class="c1"># Refresh if:</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>        <span class="c1"># 1. Older than refresh interval</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>        <span class="c1"># 2. Has been accessed recently (indicates value)</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>        <span class="c1"># 3. Is in top 20% by access count (high-value docs)</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>        <span class="n">is_stale</span> <span class="o">=</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="n">interval</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>        <span class="n">is_valuable</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">access_count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_access_count_percentile</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>        <span class="n">recently_used</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">doc</span><span class="o">.</span><span class="n">last_accessed</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">&lt;</span> <span class="mi">7</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>        <span class="k">return</span> <span class="n">is_stale</span> <span class="ow">and</span> <span class="p">(</span><span class="n">is_valuable</span> <span class="ow">or</span> <span class="n">recently_used</span><span class="p">)</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_knowledge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">ExternalDoc</span><span class="p">):</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Refresh external knowledge document.&quot;&quot;&quot;</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>            <span class="c1"># Fetch fresh content</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>            <span class="n">fresh_content</span> <span class="o">=</span> <span class="n">fetch_from_source</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">source_url</span><span class="p">)</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>            <span class="c1"># Check if content changed</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>            <span class="n">new_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">fresh_content</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>            <span class="k">if</span> <span class="n">new_hash</span> <span class="o">!=</span> <span class="n">doc</span><span class="o">.</span><span class="n">content_hash</span><span class="p">:</span>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>                <span class="c1"># Content changed - update</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>                <span class="n">doc</span><span class="o">.</span><span class="n">content_hash</span> <span class="o">=</span> <span class="n">new_hash</span>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a>                <span class="n">doc</span><span class="o">.</span><span class="n">summary</span> <span class="o">=</span> <span class="n">generate_summary</span><span class="p">(</span><span class="n">fresh_content</span><span class="p">)</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a>                <span class="n">doc</span><span class="o">.</span><span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>                <span class="c1"># Log change for version tracking</span>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">log_knowledge_change</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;content_updated&quot;</span><span class="p">)</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>        <span class="k">except</span> <span class="n">FetchError</span><span class="p">:</span>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a>            <span class="c1"># Graceful degradation: keep using cached version</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log_knowledge_change</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;fetch_failed&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="deprecation-detection">Deprecation Detection<a class="headerlink" href="#deprecation-detection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_deprecations</span><span class="p">(</span><span class="n">api_ref</span><span class="p">:</span> <span class="n">APIReference</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="sd">    Detect if API has been deprecated.</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="sd">    Methods:</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="sd">    1. Check official deprecation notices in docs</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="sd">    2. Monitor library changelogs</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="sd">    3. Track community warnings</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>    <span class="c1"># Check official docs for deprecation markers</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>    <span class="n">doc_content</span> <span class="o">=</span> <span class="n">fetch_current_docs</span><span class="p">(</span><span class="n">api_ref</span><span class="o">.</span><span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>    <span class="k">if</span> <span class="s2">&quot;deprecated&quot;</span> <span class="ow">in</span> <span class="n">doc_content</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>        <span class="n">deprecation_info</span> <span class="o">=</span> <span class="n">extract_deprecation_info</span><span class="p">(</span><span class="n">doc_content</span><span class="p">)</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>            <span class="s2">&quot;deprecated&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>            <span class="s2">&quot;deprecated_in&quot;</span><span class="p">:</span> <span class="n">deprecation_info</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>            <span class="s2">&quot;replacement&quot;</span><span class="p">:</span> <span class="n">deprecation_info</span><span class="o">.</span><span class="n">replacement_api</span><span class="p">,</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>            <span class="s2">&quot;reason&quot;</span><span class="p">:</span> <span class="n">deprecation_info</span><span class="o">.</span><span class="n">reason</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>        <span class="p">}</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>    <span class="c1"># Check changelog</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>    <span class="n">changelog</span> <span class="o">=</span> <span class="n">fetch_changelog</span><span class="p">(</span><span class="n">api_ref</span><span class="o">.</span><span class="n">namespace</span><span class="p">)</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>    <span class="n">deprecation</span> <span class="o">=</span> <span class="n">find_deprecation_in_changelog</span><span class="p">(</span><span class="n">changelog</span><span class="p">,</span> <span class="n">api_ref</span><span class="o">.</span><span class="n">function_name</span><span class="p">)</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>    <span class="k">if</span> <span class="n">deprecation</span><span class="p">:</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a>        <span class="k">return</span> <span class="n">deprecation</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<hr />
<h2 id="9-handling-large-external-knowledge-bases">9. Handling Large External Knowledge Bases<a class="headerlink" href="#9-handling-large-external-knowledge-bases" title="Permanent link">&para;</a></h2>
<h3 id="problem-100k-documents">Problem: 100k+ Documents<a class="headerlink" href="#problem-100k-documents" title="Permanent link">&para;</a></h3>
<p><strong>Challenge</strong>: Can't load all external knowledge into agent context (token limits)</p>
<p><strong>Solution</strong>: Tiered retrieval + aggressive filtering</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LargeKnowledgeBaseHandler</span><span class="p">:</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle large external knowledge bases efficiently.&quot;&quot;&quot;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ExternalKnowledgeIndex</span><span class="p">()</span>  <span class="c1"># Fast lookup structure</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">LRUCache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>     <span class="c1"># In-memory cache of frequently used docs</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExternalDoc</span><span class="p">]:</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="sd">        Query large knowledge base efficiently.</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="sd">        Strategy:</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="sd">        1. Fast keyword filtering (reduce 100k → 1k)</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="sd">        2. Semantic ranking (reduce 1k → 100)</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="sd">        3. Relevance scoring (reduce 100 → 5)</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>        <span class="c1"># Stage 1: Fast keyword filter</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>        <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">keyword_search</span><span class="p">(</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>            <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>            <span class="n">max_candidates</span><span class="o">=</span><span class="mi">1000</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>        <span class="p">)</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>        <span class="c1"># Stage 2: Semantic ranking</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>            <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">semantic_rank</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>        <span class="c1"># Stage 3: Detailed relevance scoring</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        <span class="n">ranked_results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>            <span class="n">score</span> <span class="o">=</span> <span class="n">calculate_relevance_score</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>            <span class="n">ranked_results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">score</span><span class="p">,</span> <span class="n">doc</span><span class="p">))</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>        <span class="n">ranked_results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">doc</span> <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">ranked_results</span><span class="p">[:</span><span class="n">max_results</span><span class="p">]]</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Build efficient search index for large knowledge base.&quot;&quot;&quot;</span>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>        <span class="c1"># Use inverted index for fast keyword lookup</span>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>        <span class="n">index</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_all_docs</span><span class="p">():</span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>            <span class="c1"># Extract keywords</span>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a>            <span class="n">keywords</span> <span class="o">=</span> <span class="n">extract_keywords</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>            <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
<a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a>                <span class="k">if</span> <span class="n">keyword</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index</span><span class="p">:</span>
<a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a>                    <span class="n">index</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a>                <span class="n">index</span><span class="p">[</span><span class="n">keyword</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a>
<a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>        <span class="k">return</span> <span class="n">index</span>
</code></pre></div>
<h3 id="metadata-only-storage">Metadata-Only Storage<a class="headerlink" href="#metadata-only-storage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">store_metadata_only</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">ExternalDoc</span><span class="p">):</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="sd">    Store only metadata in Neo4j, full content in file cache.</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="sd">    Neo4j storage (lightweight):</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="sd">    - id, title, source, source_url</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="sd">    - summary (500 chars max)</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="sd">    - version, language, category</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="sd">    - relevance_score, access_count</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="sd">    File cache (full content):</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="sd">    - Complete documentation</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="sd">    - Code examples</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="sd">    - Full API reference</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>    <span class="c1"># Store metadata in Neo4j</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="s2">    MERGE (doc:ExternalDoc {id: $id})</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="s2">    SET doc.title = $title,</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a><span class="s2">        doc.source = $source,</span>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="s2">        doc.source_url = $source_url,</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="s2">        doc.summary = $summary,</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="s2">        doc.version = $version,</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="s2">        doc.relevance_score = $relevance_score</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>    <span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="o">**</span><span class="n">doc</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>    <span class="c1"># Store full content in file cache</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>    <span class="n">cache_path</span> <span class="o">=</span> <span class="n">get_cache_path</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>    <span class="n">save_full_content</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">full_content</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="10-performance-considerations">10. Performance Considerations<a class="headerlink" href="#10-performance-considerations" title="Permanent link">&para;</a></h2>
<h3 id="query-performance-targets">Query Performance Targets<a class="headerlink" href="#query-performance-targets" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>Target: &lt;100ms for external knowledge queries
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>Breakdown:
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>- Relevance check: &lt;10ms (decide if external knowledge needed)
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>- Cache lookup: &lt;20ms (check if already cached)
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>- Neo4j query: &lt;50ms (fetch metadata)
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>- Full content fetch: &lt;20ms (from file cache)
</code></pre></div>
<h3 id="optimization-strategies">Optimization Strategies<a class="headerlink" href="#optimization-strategies" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># 1. Pre-compute relevance scores</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">precompute_relevance_scores</span><span class="p">():</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run nightly to update relevance scores.&quot;&quot;&quot;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="s2">    MATCH (doc:ExternalDoc)</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="s2">    SET doc.relevance_score =</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="s2">        (doc.access_count * 0.4) +</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="s2">        ((1.0 - (duration.between(doc.last_updated, datetime()).days / 730.0)) * 0.3) +</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="s2">        (size([(doc)&lt;-[:USED]-(usage:KnowledgeUsage {outcome: &quot;success&quot;}) | usage]) * 0.3)</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>    <span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="c1"># 2. Index frequently queried paths</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="s2">    CREATE INDEX external_doc_category IF NOT EXISTS</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="s2">    FOR (d:ExternalDoc) ON (d.category, d.language, d.relevance_score)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="c1"># 3. Materialize common queries</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">materialize_top_docs</span><span class="p">():</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cache top documents for each category.&quot;&quot;&quot;</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="s2">    MATCH (doc:ExternalDoc)</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="s2">    WHERE doc.category = $category AND doc.language = $language</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="s2">    WITH doc</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="s2">    ORDER BY doc.relevance_score DESC</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a><span class="s2">    LIMIT 20</span>
<a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="s2">    RETURN doc</span>
<a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>
<a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">CATEGORIES</span><span class="p">:</span>
<a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>        <span class="k">for</span> <span class="n">language</span> <span class="ow">in</span> <span class="n">LANGUAGES</span><span class="p">:</span>
<a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">)</span>
<a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>            <span class="n">cache_results</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;top_</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="11-integration-code-examples">11. Integration Code Examples<a class="headerlink" href="#11-integration-code-examples" title="Permanent link">&para;</a></h2>
<h3 id="example-1-agent-queries-external-knowledge">Example 1: Agent Queries External Knowledge<a class="headerlink" href="#example-1-agent-queries-external-knowledge" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AgentWithExternalKnowledge</span><span class="p">:</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent that uses both project memory and external knowledge.&quot;&quot;&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span> <span class="o">=</span> <span class="n">agent_id</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span> <span class="o">=</span> <span class="n">MemoryManager</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">)</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">external_knowledge</span> <span class="o">=</span> <span class="n">ExternalKnowledgeRetriever</span><span class="p">()</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute task with comprehensive knowledge context.&quot;&quot;&quot;</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>        <span class="c1"># Build context from multiple sources</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_comprehensive_context</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>        <span class="c1"># Execute with context</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute_with_context</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>        <span class="c1"># Record what knowledge was useful</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">record_knowledge_usage</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>
<a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>
<a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_comprehensive_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Build context from project memory + external knowledge.&quot;&quot;&quot;</span>
<a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>
<a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>        <span class="n">context_parts</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>
<a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>        <span class="c1"># 1. Project-specific memories (highest priority)</span>
<a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a>        <span class="n">project_memories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
<a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>            <span class="n">agent_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
<a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>            <span class="n">search</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
<a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>            <span class="n">min_importance</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a>            <span class="n">limit</span><span class="o">=</span><span class="mi">3</span>
<a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>        <span class="p">)</span>
<a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a>
<a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>        <span class="k">if</span> <span class="n">project_memories</span><span class="p">:</span>
<a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a>            <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;## Project Memory (Proven Patterns)&quot;</span><span class="p">)</span>
<a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a>            <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">project_memories</span><span class="p">:</span>
<a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>                <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">mem</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">mem</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a>
<a id="__codelineno-27-41" name="__codelineno-27-41" href="#__codelineno-27-41"></a>        <span class="c1"># 2. External knowledge (if needed)</span>
<a id="__codelineno-27-42" name="__codelineno-27-42" href="#__codelineno-27-42"></a>        <span class="n">agent_context</span> <span class="o">=</span> <span class="n">AgentContext</span><span class="p">(</span>
<a id="__codelineno-27-43" name="__codelineno-27-43" href="#__codelineno-27-43"></a>            <span class="n">agent_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_id</span><span class="p">,</span>
<a id="__codelineno-27-44" name="__codelineno-27-44" href="#__codelineno-27-44"></a>            <span class="n">current_task</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
<a id="__codelineno-27-45" name="__codelineno-27-45" href="#__codelineno-27-45"></a>            <span class="n">code_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_code_context</span><span class="p">()</span>
<a id="__codelineno-27-46" name="__codelineno-27-46" href="#__codelineno-27-46"></a>        <span class="p">)</span>
<a id="__codelineno-27-47" name="__codelineno-27-47" href="#__codelineno-27-47"></a>
<a id="__codelineno-27-48" name="__codelineno-27-48" href="#__codelineno-27-48"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_knowledge</span><span class="o">.</span><span class="n">should_query_external</span><span class="p">(</span><span class="n">agent_context</span><span class="p">):</span>
<a id="__codelineno-27-49" name="__codelineno-27-49" href="#__codelineno-27-49"></a>            <span class="n">external_docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_knowledge</span><span class="o">.</span><span class="n">retrieve_relevant_knowledge</span><span class="p">(</span>
<a id="__codelineno-27-50" name="__codelineno-27-50" href="#__codelineno-27-50"></a>                <span class="n">agent_context</span><span class="p">,</span>
<a id="__codelineno-27-51" name="__codelineno-27-51" href="#__codelineno-27-51"></a>                <span class="n">max_items</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-27-52" name="__codelineno-27-52" href="#__codelineno-27-52"></a>            <span class="p">)</span>
<a id="__codelineno-27-53" name="__codelineno-27-53" href="#__codelineno-27-53"></a>
<a id="__codelineno-27-54" name="__codelineno-27-54" href="#__codelineno-27-54"></a>            <span class="k">if</span> <span class="n">external_docs</span><span class="p">:</span>
<a id="__codelineno-27-55" name="__codelineno-27-55" href="#__codelineno-27-55"></a>                <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">## External Reference (Advisory)&quot;</span><span class="p">)</span>
<a id="__codelineno-27-56" name="__codelineno-27-56" href="#__codelineno-27-56"></a>                <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">external_docs</span><span class="p">:</span>
<a id="__codelineno-27-57" name="__codelineno-27-57" href="#__codelineno-27-57"></a>                    <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-27-58" name="__codelineno-27-58" href="#__codelineno-27-58"></a>                        <span class="sa">f</span><span class="s2">&quot;- [</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-27-59" name="__codelineno-27-59" href="#__codelineno-27-59"></a>                        <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">summary</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-27-60" name="__codelineno-27-60" href="#__codelineno-27-60"></a>                        <span class="sa">f</span><span class="s2">&quot;  URL: </span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">source_url</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-27-61" name="__codelineno-27-61" href="#__codelineno-27-61"></a>                    <span class="p">)</span>
<a id="__codelineno-27-62" name="__codelineno-27-62" href="#__codelineno-27-62"></a>
<a id="__codelineno-27-63" name="__codelineno-27-63" href="#__codelineno-27-63"></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_parts</span><span class="p">)</span>
</code></pre></div>
<h3 id="example-2-automatic-api-documentation-linking">Example 2: Automatic API Documentation Linking<a class="headerlink" href="#example-2-automatic-api-documentation-linking" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">link_api_usage_to_docs</span><span class="p">(</span><span class="n">code_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="sd">    Automatically link API usage in code to external documentation.</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="sd">    Process:</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="sd">    1. Parse code to find API calls</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="sd">    2. Query external knowledge for matching API docs</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="sd">    3. Create relationships in Neo4j</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="sd">    4. Cache for fast retrieval</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>    <span class="c1"># Parse code</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>    <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>    <span class="n">api_calls</span> <span class="o">=</span> <span class="n">extract_api_calls</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>    <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">api_calls</span><span class="p">:</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>        <span class="c1"># Find or fetch API documentation</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>        <span class="n">api_doc</span> <span class="o">=</span> <span class="n">find_or_fetch_api_doc</span><span class="p">(</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>            <span class="n">namespace</span><span class="o">=</span><span class="n">call</span><span class="o">.</span><span class="n">module</span><span class="p">,</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>            <span class="n">function</span><span class="o">=</span><span class="n">call</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>            <span class="n">version</span><span class="o">=</span><span class="n">detect_package_version</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">module</span><span class="p">)</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>        <span class="p">)</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>        <span class="k">if</span> <span class="n">api_doc</span><span class="p">:</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>            <span class="c1"># Create relationship in Neo4j</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>            <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a><span class="s2">            MATCH (file:CodeFile {path: $file_path})</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="s2">            MATCH (api:APIReference {id: $api_id})</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="s2">            MERGE (api)-[:USED_IN {</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="s2">                line_number: $line_number,</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="s2">                context: $context</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="s2">            }]-&gt;(file)</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>            <span class="n">neo4j</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span>
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>                     <span class="n">file_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">code_file</span><span class="p">),</span>
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>                     <span class="n">api_id</span><span class="o">=</span><span class="n">api_doc</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>                     <span class="n">line_number</span><span class="o">=</span><span class="n">call</span><span class="o">.</span><span class="n">line_number</span><span class="p">,</span>
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a>                     <span class="n">context</span><span class="o">=</span><span class="n">call</span><span class="o">.</span><span class="n">context_code</span><span class="p">)</span>
</code></pre></div>
<h3 id="example-3-error-driven-knowledge-fetching">Example 3: Error-Driven Knowledge Fetching<a class="headerlink" href="#example-3-error-driven-knowledge-fetching" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ErrorDrivenKnowledgeFetcher</span><span class="p">:</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch external knowledge based on error patterns.&quot;&quot;&quot;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">code_context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="sd">        Fetch relevant external knowledge for error resolution.</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="sd">        Priority:</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="sd">        1. Check project memory for previous solutions</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="sd">        2. Query external knowledge for error pattern</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="sd">        3. Return most relevant solution</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>        <span class="n">error_pattern</span> <span class="o">=</span> <span class="n">classify_error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>        <span class="c1"># Check project memory first</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>        <span class="n">project_solutions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>            <span class="n">memory_type</span><span class="o">=</span><span class="n">MemoryType</span><span class="o">.</span><span class="n">PATTERN</span><span class="p">,</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>            <span class="n">search</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>            <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;error_solution&quot;</span><span class="p">]</span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>        <span class="p">)</span>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>        <span class="k">if</span> <span class="n">project_solutions</span><span class="p">:</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>            <span class="c1"># We&#39;ve solved this before</span>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>            <span class="k">return</span> <span class="n">project_solutions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>        <span class="c1"># Query external knowledge</span>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>        <span class="n">external_solutions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_external_error_solutions</span><span class="p">(</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>            <span class="n">error_pattern</span><span class="o">=</span><span class="n">error_pattern</span><span class="p">,</span>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a>            <span class="n">code_context</span><span class="o">=</span><span class="n">code_context</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a>        <span class="p">)</span>
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a>
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a>        <span class="k">if</span> <span class="n">external_solutions</span><span class="p">:</span>
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a>            <span class="n">best_solution</span> <span class="o">=</span> <span class="n">external_solutions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a>
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a>            <span class="c1"># Store in project memory for future</span>
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">memory_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a>                <span class="n">agent_id</span><span class="o">=</span><span class="s2">&quot;error_handler&quot;</span><span class="p">,</span>
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a>                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Solution: </span><span class="si">{</span><span class="n">error_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a>                <span class="n">content</span><span class="o">=</span><span class="n">best_solution</span><span class="o">.</span><span class="n">solution</span><span class="p">,</span>
<a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a>                <span class="n">memory_type</span><span class="o">=</span><span class="n">MemoryType</span><span class="o">.</span><span class="n">PATTERN</span><span class="p">,</span>
<a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a>                <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;error_solution&quot;</span><span class="p">,</span> <span class="n">error_pattern</span><span class="p">],</span>
<a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a>                <span class="n">importance</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a>                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a>                    <span class="s2">&quot;external_source&quot;</span><span class="p">:</span> <span class="n">best_solution</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
<a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a>                    <span class="s2">&quot;source_url&quot;</span><span class="p">:</span> <span class="n">best_solution</span><span class="o">.</span><span class="n">url</span>
<a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a>                <span class="p">}</span>
<a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a>            <span class="p">)</span>
<a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a>
<a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a>            <span class="k">return</span> <span class="n">best_solution</span><span class="o">.</span><span class="n">solution</span>
<a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a>
<a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
<hr />
<h2 id="12-progressive-implementation-plan">12. Progressive Implementation Plan<a class="headerlink" href="#12-progressive-implementation-plan" title="Permanent link">&para;</a></h2>
<h3 id="phase-1-foundation-week-1">Phase 1: Foundation (Week 1)<a class="headerlink" href="#phase-1-foundation-week-1" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: File-based cache + basic Neo4j metadata</p>
<p><strong>Tasks</strong>:</p>
<ol>
<li>Implement <code>ExternalKnowledgeCache</code> (file-based)</li>
<li>Create Neo4j schema (ExternalDoc, APIReference nodes)</li>
<li>Build basic fetch functions for official docs</li>
<li>Test with single source (e.g., Python docs)</li>
</ol>
<p><strong>Deliverable</strong>: Can fetch and cache Python official docs</p>
<h3 id="phase-2-integration-week-2">Phase 2: Integration (Week 2)<a class="headerlink" href="#phase-2-integration-week-2" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: Integrate with existing memory system</p>
<p><strong>Tasks</strong>:</p>
<ol>
<li>Implement <code>should_query_external()</code> logic</li>
<li>Add external knowledge to agent context builder</li>
<li>Create Neo4j relationships to code files</li>
<li>Test with architect agent</li>
</ol>
<p><strong>Deliverable</strong>: Agents can query external knowledge when needed</p>
<h3 id="phase-3-multiple-sources-week-3">Phase 3: Multiple Sources (Week 3)<a class="headerlink" href="#phase-3-multiple-sources-week-3" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: Support multiple knowledge sources</p>
<p><strong>Tasks</strong>:</p>
<ol>
<li>Add MS Learn fetcher</li>
<li>Add MDN fetcher</li>
<li>Add StackOverflow fetcher (with filtering)</li>
<li>Implement source credibility scoring</li>
</ol>
<p><strong>Deliverable</strong>: Multi-source knowledge retrieval</p>
<h3 id="phase-4-optimization-week-4">Phase 4: Optimization (Week 4)<a class="headerlink" href="#phase-4-optimization-week-4" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: Performance and ranking</p>
<p><strong>Tasks</strong>:</p>
<ol>
<li>Implement relevance scoring</li>
<li>Add usage tracking</li>
<li>Build recommendation engine</li>
<li>Performance testing</li>
</ol>
<p><strong>Deliverable</strong>: &lt;100ms query performance</p>
<h3 id="phase-5-learning-week-5">Phase 5: Learning (Week 5)<a class="headerlink" href="#phase-5-learning-week-5" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: Adaptive knowledge retrieval</p>
<p><strong>Tasks</strong>:</p>
<ol>
<li>Track which knowledge helps</li>
<li>Implement feedback loop</li>
<li>Auto-refresh stale content</li>
<li>Deprecation detection</li>
</ol>
<p><strong>Deliverable</strong>: Self-improving knowledge system</p>
<hr />
<h2 id="13-success-metrics">13. Success Metrics<a class="headerlink" href="#13-success-metrics" title="Permanent link">&para;</a></h2>
<h3 id="performance-metrics">Performance Metrics<a class="headerlink" href="#performance-metrics" title="Permanent link">&para;</a></h3>
<ul>
<li>External knowledge query time: &lt;100ms (p95)</li>
<li>Cache hit rate: &gt;80%</li>
<li>Neo4j query time: &lt;50ms (p95)</li>
</ul>
<h3 id="quality-metrics">Quality Metrics<a class="headerlink" href="#quality-metrics" title="Permanent link">&para;</a></h3>
<ul>
<li>Source credibility score: &gt;0.7 average</li>
<li>Knowledge freshness: &lt;30 days average age for high-use docs</li>
<li>Agent satisfaction: Track when external knowledge was useful</li>
</ul>
<h3 id="usage-metrics">Usage Metrics<a class="headerlink" href="#usage-metrics" title="Permanent link">&para;</a></h3>
<ul>
<li>External knowledge query rate: 20-40% of agent tasks</li>
<li>Cache efficiency: &gt;80% hit rate</li>
<li>Storage efficiency: &lt;100MB for 10k documents (metadata only)</li>
</ul>
<hr />
<h2 id="14-monitoring-maintenance">14. Monitoring &amp; Maintenance<a class="headerlink" href="#14-monitoring-maintenance" title="Permanent link">&para;</a></h2>
<h3 id="daily-operations">Daily Operations<a class="headerlink" href="#daily-operations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">daily_maintenance</span><span class="p">():</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Daily maintenance tasks.&quot;&quot;&quot;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>    <span class="c1"># 1. Update relevance scores</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="n">precompute_relevance_scores</span><span class="p">()</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="c1"># 2. Refresh high-value docs</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>    <span class="n">refresh_high_value_docs</span><span class="p">()</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>    <span class="c1"># 3. Clean up unused cache</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>    <span class="n">cleanup_cache</span><span class="p">(</span><span class="n">older_than_days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</code></pre></div>
<h3 id="weekly-analysis">Weekly Analysis<a class="headerlink" href="#weekly-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">weekly_analysis</span><span class="p">():</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze external knowledge usage patterns.&quot;&quot;&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    <span class="c1"># 1. Top 20 most used docs</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>    <span class="n">top_docs</span> <span class="o">=</span> <span class="n">get_top_documents</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>    <span class="c1"># 2. Unused docs (consider removing)</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>    <span class="n">unused_docs</span> <span class="o">=</span> <span class="n">get_documents_never_accessed</span><span class="p">(</span><span class="n">age_days</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>    <span class="c1"># 3. Source effectiveness</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>    <span class="n">source_stats</span> <span class="o">=</span> <span class="n">analyze_source_effectiveness</span><span class="p">()</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>    <span class="c1"># 4. Knowledge gaps</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="n">identify_knowledge_gaps</span><span class="p">()</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>        <span class="s2">&quot;top_docs&quot;</span><span class="p">:</span> <span class="n">top_docs</span><span class="p">,</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>        <span class="s2">&quot;unused_docs&quot;</span><span class="p">:</span> <span class="n">unused_docs</span><span class="p">,</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>        <span class="s2">&quot;source_stats&quot;</span><span class="p">:</span> <span class="n">source_stats</span><span class="p">,</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>        <span class="s2">&quot;gaps&quot;</span><span class="p">:</span> <span class="n">gaps</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>    <span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="15-key-principles-summary">15. Key Principles (Summary)<a class="headerlink" href="#15-key-principles-summary" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Project Memory First</strong>: External knowledge is advisory, never replaces project-specific memory</li>
<li><strong>Cache Aggressively</strong>: File-based cache with smart refresh</li>
<li><strong>Measure Before Optimizing</strong>: Start simple, measure, optimize based on data</li>
<li><strong>Version Awareness</strong>: Always track version compatibility</li>
<li><strong>Source Credibility</strong>: Rank sources by trust score</li>
<li><strong>Graceful Degradation</strong>: System works even if external knowledge unavailable</li>
<li><strong>Lightweight Metadata</strong>: Store metadata in Neo4j, full content in files</li>
<li><strong>Learning Loop</strong>: Track what works, improve recommendations</li>
<li><strong>Performance First</strong>: &lt;100ms query target</li>
<li><strong>User Control</strong>: Never override explicit user requirements</li>
</ol>
<hr />
<h2 id="file-locations">File Locations<a class="headerlink" href="#file-locations" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>Implementation:
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>- src/amplihack/external_knowledge/cache.py
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>- src/amplihack/external_knowledge/retriever.py
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>- src/amplihack/external_knowledge/neo4j_schema.py
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>- src/amplihack/external_knowledge/sources/
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>Data Storage:
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>- ~/.amplihack/external_knowledge/cache/    (file cache)
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>- Neo4j database (metadata + relationships)
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>Integration:
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>- src/amplihack/memory/manager.py           (add external knowledge queries)
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>- .claude/agents/*/                         (no changes - agents remain stateless)
</code></pre></div>
<hr />
<p><strong>END OF DESIGN DOCUMENT</strong></p>
<p>This design follows the project's ruthless simplicity philosophy: start with file-based caching, measure what's needed, and only add Neo4j complexity where it provides clear value (relationships, fast metadata queries, version tracking). External knowledge is always advisory and never overrides project-specific memory.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.tabs", "navigation.sections", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>